<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Board">

    <!-- 글 저장하기 -->
    <insert  id="BoardInsert" >
        insert into board
        (
        b_idx,
        title,
        cont,
        r_score,
        b_count,
        menu_id,
        u_id,
        g_idx
        )
        values
        (
        ( select nvl(max(b_idx),0)+1 from board ),
        #{title},
        #{cont},
        #{r_score},
        0,
        #{menu_id},
        #{u_id},
        #{g_idx}
        )
    </insert>

    <!-- 글 수정 -->
    <update  id="BoardUpdate">
        update board
        set   title   = #{title},
              cont    = #{cont},
              r_score = #{r_score}
        where b_idx   = #{b_idx}
    </update>

    <select id="getGameList" resultType="com.project.board.vo.GameListVo">
        SELECT *
          FROM GAMELIST
    </select>

    <!-- 글 전체 목록 카운트 -->
    <select id="BoardCount"
            resultType="int">
        SELECT COUNT(*)
        FROM BOARD
        where menu_id = ${menu_id}
    </select>

    <select id="BoardOneCount"
            resultType="int">
        SELECT COUNT(*)
        FROM BOARD
        where menu_id = ${menu_id} and g_idx = ${g_idx}
    </select>

    <select id="BoardSCount"
            resultType="int">
        select count(*)
        from(
        select ROW_NUMBER() OVER (ORDER BY B_IDX ASC) RNUM,
        a.b_idx,
        a.title,
        a.cont,
        a.r_score,
        TO_CHAR(a.INDATE + 9/24, 'yyyy-mm-dd hh24:mi:ss') AS indate,
        a.b_count,
        a.menu_id,
        b.g_name,
        a.g_idx,
        a.u_id
        from  board a
        inner join gamelist b
        on a.g_idx = b.g_idx
        where menu_id = ${menu_id} and ${searchType} like '%${keyword}%'
        order by b_idx asc)
    </select>

    <!-- 글 목록 불러오기 -->
    <select id="List"
            resultType="com.project.board.vo.BoardVo">
        <choose>
            <when test="g_idx != null">
                select *
                from(
                select ROW_NUMBER() OVER (ORDER BY B_IDX ASC) RNUM,
                a.b_idx,
                a.title,
                a.cont,
                a.r_score,
                TO_CHAR(a.INDATE + 9/24, 'yyyy-mm-dd hh24:mi:ss') AS indate,
                a.b_count,
                a.menu_id,
                b.g_name,
                a.g_idx,
                a.u_id
                from  board a
                inner join gamelist b
                on a.g_idx = b.g_idx
                where menu_id = ${menu_id} and a.g_idx = ${g_idx}
                order by b_idx asc)
                WHERE RNUM BETWEEN ${pageNum} and #{contentNum}
            </when>
            <otherwise>
                select *
                from(
                select ROW_NUMBER() OVER (ORDER BY B_IDX ASC) RNUM,
                a.b_idx,
                a.title,
                a.cont,
                a.r_score,
                TO_CHAR(a.INDATE + 9/24, 'yyyy-mm-dd hh24:mi:ss') AS indate,
                a.b_count,
                a.menu_id,
                b.g_name,
                a.g_idx,
                a.u_id
                from  board a
                inner join gamelist b
                on a.g_idx = b.g_idx
                where menu_id = ${menu_id}
                order by b_idx asc)
                WHERE RNUM BETWEEN ${pageNum} and #{contentNum}
            </otherwise>
        </choose>
    </select>

    <select id="SList"
            resultType="com.project.board.vo.BoardVo">
        select *
        from(
        select ROW_NUMBER() OVER (ORDER BY B_IDX ASC) RNUM,
        a.b_idx,
        a.title,
        a.cont,
        a.r_score,
        TO_CHAR(a.INDATE + 9/24, 'yyyy-mm-dd hh24:mi:ss') AS indate,
        a.b_count,
        a.menu_id,
        b.g_name,
        a.g_idx,
        a.u_id
        from  board a
        inner join gamelist b
        on a.g_idx = b.g_idx
        where menu_id = ${menu_id} and ${searchType} like '%${keyword}%'
        order by b_idx asc)
        WHERE RNUM BETWEEN ${pageNum} and ${contentNum}
    </select>

    <!-- 글 불러오기 -->
    <select id="View"
            resultType="com.project.board.vo.BoardVo">
        select *
        from board
        where b_idx = #{b_idx}
    </select>

    <!-- 조회수 증가 -->
    <update  id="ReadCountUpdate">
        update board
        set  b_count = b_count + 1
        where b_idx = #{b_idx}
    </update>

    <!-- 글 삭제하기 -->
    <delete id="Delete">
        delete from board
        where b_idx = #{b_idx}
    </delete>

</mapper>